<style type="text/css">
    .bs-example{
    	margin: 20px;
    }
  .accordion-toggle {cursor: pointer;}
  .accordion-content {display: none;}
  .accordion-content.default {display: block;}
  .accordion-content{padding:10px; border-bottom:1px solid #ccc;}
  .accordion h4{
	background-color:#f9f9f9;
	padding:10px; 
	font-size:16px;
	border-bottom:1px solid #ccc; 
  }
  a, a:hover, a:focus{
outline:0;	
}
#accordion{
border:1px solid #ccc;
margin:0;
border-bottom:0;	
}
.accordion h4{
margin:0;	
}
.bom_detail{   
    width: 98%;
    height: auto;
    /*border: 1px solid #DDDDDD;;*/
    background-color: #f5f5f5;
    margin-bottom: 10px;
    border-radius: 5px;
    padding: 5px;
    box-shadow: 1px 1px 3px -1px;
}
.bom_detail p{margin: 0 auto;}

.form-addbom {
/*  max-width: 60%;
*/  padding: 19px 29px 29px;/*
  margin: 50px auto 20px;
  background-color: #fff;
  border: 1px solid #e5e5e5;*/
  -webkit-border-radius: 5px;
  -moz-border-radius: 5px;
  border-radius: 5px;
  -webkit-box-shadow: 0 1px 2px rgba(0,0,0,.05);
  -moz-box-shadow: 0 1px 2px rgba(0,0,0,.05);
  box-shadow: 0 1px 2px rgba(0,0,0,.05);
}
.form-left{width:45% !important;}
.form-right{width:50% !important;}

td select{width: 100px !important;
/*border: none;*/
    background-color: transparent;
    box-shadow: none;
    margin: 0px !important;}
td input{width: 80px !important;
/*border: none !important;*/
    /*background-color: transparent !important;*/
    box-shadow: none !important;
    margin: 0px !important;}
#example1 .table td{    padding: 8px 4px 0 5px !important;}

*
{
    padding: 0;
    margin: 0;
}
#mask
{
    position:absolute;
    width:100%;
    height:100%;
    text-align: center; /*handles the horizontal centering*/
}
/*handles the vertical centering*/
.Centerer
{
    display: inline-block;
    height: 100%;
    vertical-align: middle;
}
.Centered
{
    display: inline-block;
    vertical-align: middle;
}
.DTTT_container{display:none;}
</style>


 <div class="span3" id="sidebar">
                    <ul class="nav nav-list bs-docs-sidenav nav-collapse collapse">
                        <li class="active">
                            <a href="<?=$this->url(array('module'=>'admin','controller'=>'bom','action'=>'index'))?>">
                                <i class="icon-chevron-right"></i>Bill of material</a>
                        </li>
                        
                        <li>
                            <a href="<?=$this->url(array('module'=>'admin','controller'=>'bom','action'=>'index'))?>">
                                Bill of material</a>
                        </li>
                        
                       
                        
                </ul>
           </div>

<div class="span9" id="content">
       <?php echo $this->render('globalmessage/globalmessage.phtml'); ?>
    
<!-- CLIENTS LIST-->
      
    <div class="row">
                        <div class="span12">
                            <!-- block -->
                            <div class="block">
                                <div class="navbar navbar-inner block-header">
                                    <div class="muted pull-left">Bill of Material</div>
                                    
                                </div>
                                 <div class="accordion block-content collapse in" id="accordion2">
  
                                  <ul class="nav nav-tabs" id="myTab">
  <li class="active materiallist"><a href="#materiallist">Bill of Material List</a></li>
  <li class="addbom"><a href="#addbom">Create New Bill of Material</a></li>
  <!--<li class="addredit hidden"><a href="#add-edit" class='addoredit'></a></li>-->
  
  </ul>
 
                                     
<div class="tab-content">
  <div class="tab-pane active" id="materiallist">
      <table cellpadding="0" cellspacing="0" border="0" class="table table-striped table-bordered dataTable" id="example">
                                        <thead>
                                            <tr> 
                                                <th>#</th>
                                                <th>BOM#</th>
                                                <th>BOM Rev#</th>
<!--                                                <th>Part Description</th>
                                                <th>Qty</th>
                                                <th>UOM</th>
                                                <th>Dwg #</th>
                                                <th>Dwg Rev #</th>-->
                                                <th>Description</th>
                                                <th>Action</th>
                                                <th>Status</th>
                                                
                                            </tr>
                                        </thead>
                                        <tbody>
                                            
                                             <?php $i=1; foreach($this->bom as $bom){ ?>
                                            <tr><td><?=$i++;?></td>
                                                <td><a href="#" class="add-bom" id="<?=$bom['material_id']?>">
                                             <?=$bom['bom_project_id']?>
                                                    </a></td>
                                                <td><?php if($bom['bom_rev_id']){echo $bom['bom_rev_id'];} else{ echo 'NONE'; } ?></td>
<!--                                                <td><?=$bom['material_desc']?></td>
                                                <td><?=$bom['qty']?></td>
                                                <td><?=$bom['uom']?></td>
                                                <td><?=$bom['drawing_no']?></td>
                                                <td><?=$bom['revision_no']?></td>-->
                                                
                                                
         <td><?=$bom['bom_description']?></td>                                      
         <td>
<!--                                                    <a href="<?php echo $this->baseUrl(); ?>/admin/auth/bom/delete_bom/<?=$bom['id']?>" >
                                                        <?php echo 'DEL '; ?></a>-->
                                                   
                                                    <a href="#" class="edit-bom" id="<?=$bom['id']?>">
                                                <?php echo 'EDIT / '; ?></a>
                                                        <a href="#" class="view-bom" id="<?=$bom['id']?>">
                                                <?php echo 'VIEW'; ?></a>
                                            
                                                </td> 
                                                
                                                 <td>
                                                <?php if($bom['status'] == '0'){ ?>
                                                    <img class="imgswap" id="approval_<?php echo $bom['id']; ?>" src="<?php echo $this->baseUrl();?>/public/images/tick_off.png"/>
                                                    <?php }  if($bom['status'] == '1'){ ?>
                                                    <img class="imgswap on" id="approval_<?php echo $bom['id']; ?>" src="<?php echo $this->baseUrl();?>/public/images/tick_on.png"/>
                                                    <?php } ?>
                                                 </td>
                                            
                                            </tr>
                                            <?php }?>
                                            
                                        </tbody>
                                    </table>
  </div>
    
    
  
  
    <div class="tab-pane" id="addbom">

                   <form  enctype="application/x-www-form-urlencoded" action="#" method="post" id="form_addbom" name="form_addbom" class='form_addbom'>

                       
        <div class='bom_detail'>

            <input type="hidden" name="bom-edit-id" id="bom-edit-id" class="bom-edit-id" value="" />
            <input type="hidden" name="material-id" id="material-id" class="material-id" value="" />
            
            <div class="formvalue form-group clearfix">
                <div class="form-left pull-left"><label for="partno" class="required">Part no:</label></div>
                <div class="input-group form-right pull-left">
           
                    <select name="partno" id="partno" class="form-control" required>
                        <option value="">Select Part No</option>
                        <?php foreach ($this->material as $_material): ?>
                            <option value="<?= $_material['id'] ?>"><?= $_material['part_no'] ?></option>
                        <?php endforeach; ?>

                    </select>              
                </div>
                <div class="form-left pull-left"></div>
            </div>

            <div class="formvalue form-group clearfix">
                <div class="form-left pull-left"><label for="firstname" class="required">Project:</label></div>
                <div class="input-group form-right pull-left">

                    <select name="project" id="project" class="form-control" required>
                        <option value="">Select Project</option>
                        <?php foreach ($this->project as $_project): ?>
                            <option value="<?= $_project['project_id'] ?>"><?= $_project['project_name'] ?></option>
                        <?php endforeach; ?>


                    </select>              
                </div>
                <div class="form-left pull-left"></div>
            </div>
<div class="formvalue form-group clearfix">
                <div class="form-left pull-left"><label for="bom_description" class="required">BOM Description:</label></div>
                <div class="input-group form-right pull-left">

                <textarea rows="5" cols="200" name="bom_description" id="bom_description" value="" class="form-control" required></textarea>
         
                </div>
                <div class="form-left pull-left"></div>
            </div>

        </div>

<!--        <div id="button_div" class="clearfix span7" style="float: right;" >
            <div class="span2" id="save_button">
                <a class='btn btn-primary'  name="save_bom" id="save_bom" value="Save" class="btn btn-default save_bom" />Save</a>
            </div>

            <div class="span1" id="back_button">
                <a href=""><input class='btn btn-primary' type="button" name="back" id="back" value="Back" class="btn btn-default" /></a>
            </div>
                            <a href="" style="display:none;">
                                <input type="reset" name="reset" id="reset-bom" value="Reset" class="btn btn-primary">
                               </a>

        </div>-->
                        <a href="" style="display:none;">
                                <input type="reset" name="reset" id="reset-bom" value="Reset" class="btn btn-primary">
                               </a>
                   </form>
        
        <form data-toggle="validator"  enctype="application/x-www-form-urlencoded" action="#" method="post" id="addtobom" name="addtobom" class='addtobom'>

        <input type="hidden" value="" name="bom-id" id="bom-id">
        <input type="hidden" value="" name="op-type" id="op-type">
        <div class="bom_detail" id='bom-detail'>
          

        </div>
        
     <table cellpadding="0" cellspacing="0" border="0" class="table table-striped table-bordered dataTable" id="example1">
        
                                        <thead>
                                            <tr> 
                                                <th>#</th>
                                                <th>Part no#</th>
                                                <th>Description</th>
                                                <th>Type</th>
                                                <th>Qty</th>
                                                <th>UOM</th>
                                                <th>Dwg #</th>
                                                <th>Dwg Rev #</th>
                                                <th>Comments</th>
                                                <th>Action</th>
                                                
                                            </tr>
                                        </thead>
                                        <tbody>
                                            
                                            
                                        </tbody>
                                    </table>
        
        <div style='float:right;'>
             <a id='addnew'  name='addnew' class='btn btn-primary' >Add New</a>
             <a id='addall'  name='addall' class='btn btn-primary' >Save All</a>
             <a id='import'  name='import' class='btn btn-primary' >Import</a>
             <a id='pdf' onclick="pdfOfBom('<?=$this->url(array('module'=>'admin','controller'=>'bom','action'=>'bomtopdf'))?>');"  name='PDF' target="_blank" class='btn btn-primary' >PDF</a>
        </div>
                           </form>   
    </div>
    
<!--    <div class="tab-pane" id="add-edit">
        
                                   
    </div>-->

     <script type="text/javascript">
         
         
         
function pdfOfBom(url) {
       var id = $('#bom-id').val();
       var url=url+'/id/'+id;
       var win = window.open(url, '_blank');
       win.focus();
                       }
//$(document).ready(function(){function t(t){$.ajax({url:a+"/view",type:"post",data:"&bom_id="+t,success:function(t){var e=$.parseJSON(t);$("#bom-id").val(e.id),$("#op-type").val("add");var a='<p><span style="color:red;">ASSEMBLY PART NO:</span> '+e.partid+'</p><p><span style="color:red;">MATERIAL DESCRIPTION:</span>'+e.description+'</p><p><span style="color:red;">BOM #:</span>'+e.bom+'</p><p><span style="color:red;">BOM REV#:</span>'+e.bom_rev+'</p><p><span style="color:red;">DATE:</span>'+e.date+"</p>";$("#bom-detail").html(a),$("#bom_id").val(e.id.id),$("#example1").dataTable().fnClearTable(),$(e.table).each(function(t,a){var o='<select update="'+a.id+'" id="part_'+a.id+'" class="partno" name="partno[]" ><option>Slect Part no</option>';$(e.partno).each(function(t,e){o+=a.material_id==e.id?'<option value="'+e.id+'" selected="true">'+e.part_no+"</option>":'<option value="'+e.id+'">'+e.part_no+"</option>"}),o+="</select>";var d='<input id="desc_'+a.id+'" type="text" value="'+a.material_desc+'" class="desc" readonly="true">\n                                    <input type="hidden" name="bom_ref_id[]"  value="'+a.id+'">',n='<input id="type_'+a.id+'" type="text" value="'+a.type+'" class="type" readonly="true">',r='<input name="qty[]" update="'+a.id+'" id="qty_'+a.id+'" type="number" value="'+a.quanty+'" class="qty" >',l='<input id="uom_'+a.id+'" type="text" value="'+a.uom+'" class="uom" readonly="true">',s='<input id="deg_'+a.id+'" type="text" value="'+a.drawing_no+'" class="dwg" readonly="true">',i='<input id="dwgr'+a.id+'" type="text" value="'+a.revision_no+'" class="dwgr" readonly="true">',c='<input name="comments[]" update="'+a.id+'" id="comments_'+a.id+'" type="text" value="'+a.comments+'" class="comments">',m=$("#example1").dataTable().fnSettings().fnRecordsTotal();$("#example1").dataTable().fnAddData([m+1,o,d,n,r,l,s,i,c,'<a style="cursor:pointer" del="'+a.id+'" id="del'+a.id+'" class="deleterow">DEL</a><br/><a style="cursor:pointer" edit="'+a.id+'" id="edit'+a.id+'" class="updaterow"></a>'])}),$(".bom").removeClass("hidden"),$('#myTab a[href="#add-edit"]').tab("show")}})}function e(t,e){$("#bommodal-header").html(t),$(".bommodal-create").html("<p>"+e+"</p>"),$("#bommodal").modal()}$("#example1").dataTableExt.sErrMode="throw";var a="/asteria/admin/bom";$(".add-bom").click(function(){$(this).attr("id");$(".addoredit").html("Add to BOM"),$(".addredit").removeClass("hidden"),$("#example1").dataTable().fnClearTable();var e=$(this).attr("id");t(e)}),$("#addnew").click(function(){var t=$("#example1").DataTable(),e=t.page.info();$("#example1 tbody tr").removeClass("current-bom");var o=$("#bom-id").val();$.ajax({url:a+"/addnew",type:"post",data:"&addnew_id="+o,success:function(t){var e=$.parseJSON(t),a=$("#example1").dataTable().fnSettings().fnRecordsTotal(),o='<select class="partno partno'+a+'" name="partnonew[]" ><option value="0">Slect Part no</option>';$(e).each(function(t,e){o+='<option value="'+e.id+'">'+e.part_no+"</option>"}),o+="</select>";var d='<input  type="text" value="" class="desc" readonly="true">',n='<input type="text" value="" class="type" readonly="true">',r='<input name="qtynew[]" type="number" value="" class="qty qty'+a+'" required="true">',l='<input type="text" value="" class="uom" readonly="true">',s='<input type="text" value="" class="dwg" readonly="true">',i='<input type="text" value="" class="dwgr" readonly="true">',c='<input name="commentsnew[]" type="text" value="" class="comments comments'+a+'" required="true">';$("#example1").dataTable().fnAddData([a+1,o,d,n,r,l,s,i,c,'<a style="cursor:pointer" class="deleterow">DEL</a><br/><a style="cursor:pointer" class="saverow">SAVE</a>'])},complete:function(){$("#example1").dataTable().fnPageChange(e.pages-1,!0)}})}),$(document).on("change","#example1 tbody tr td input[type=text],select,input[type=number]",function(){localStorage.setItem("addall","1")}),$("#addall").click(function(){var e=localStorage.getItem("addall");if("1"==e){$("#mask").show();var o=$("#addtobom").serializeJSON();$.post(a+"/addall",{data:o}).done(function(){var e=$("#bom-id").val();t(e),$("#mask").hide(),localStorage.removeItem("addall")})}else alert("Please add new or edit")}),$(document).on("click","#example1 tbody tr td .deleterow",function(){var e=$(this).closest("tr"),o=e[0],d=$("#bom-id").val(),n=$(this).attr("del");n?($("#mask").show(),$.ajax({type:"POST",url:a+"/delete",data:"&delid="+n,success:function(){t(d),$("#example1").dataTable().fnDeleteRow(o),$("#mask").hide()}})):$("#example1").dataTable().fnDeleteRow(o)}),$(document).on("change","#example1 tbody tr td .partno",function(){var t=$(this).attr("update");$("#edit"+t).html("UPDATE")}),$(document).on("change keydown","#example1 tbody tr td .qty",function(){var t=$(this).attr("update");$("#edit"+t).html("UPDATE")}),$(document).on("change","#example1 tbody tr td .comments",function(){var t=$(this).attr("update");$("#edit"+t).html("UPDATE")}),$(document).on("click","#example1 tbody tr td .updaterow",function(){var e=$(this).attr("edit");$("#mask").show(),$(this).parent("td").parent("tr").addClass("save-bom");var o=$("#bom-id").val(),d=$("#part_"+e).val(),n=$("#qty_"+e).val(),r=$("#comments_"+e).val(),l="&editid=1&id="+o+"&partno="+d+"&qty="+n+"&comments="+r+"&edit="+e;$.ajax({type:"POST",url:a+"/addoredit",data:l,success:function(e){$.parseJSON(e);t(o),$("#example1 tbody tr").removeClass("save-bom"),$("#mask").hide()}})}),$(document).on("change keydown","#example1 tbody tr td .comments",function(){var t=$(this).attr("update");$("#edit"+t).html("UPDATE")}),$(".imgswap").click(function(){var t=$(this).attr("id"),e=t.split("_");if("imgswap"==$(this).attr("class")){$("#"+t).attr("src","<?php echo $this->baseUrl();?>/public/images/tick_on.png"),this.src=this.src.replace("_off","_on");var o="1"}else{$("#"+t).attr("src","<?php echo $this->baseUrl();?>/public/images/tick_off.png"),this.src=this.src.replace("_on","_off");var o="0"}$(this).toggleClass("on");var d="&type=changestatus&id="+e[1]+"&status="+o;$.ajax({type:"POST",url:a+"/changestatus",data:d,success:function(t){console.log(t)}})}),$(document).on("change","#example1 tbody tr td .partno",function(){{var t=$(this).val();$(this).parent("td").parent("tr").addClass("current-bom")}0==t&&($(".current-bom td .desc").val(""),$(".current-bom td .type").val(""),$(".current-bom td .uom").val(""),$(".current-bom td .dwg").val(""),$(".current-bom td .dwgr").val(""),$("#example1 tbody tr").removeClass("current-bom")),0!=t&&$.ajax({type:"POST",url:a+"/addbom",data:"&bom_add="+t,async:!1,success:function(t){var e=$.parseJSON(t);$(".current-bom td .desc").val(e.material_desc),$(".current-bom td .type").val(e.type),$(".current-bom td .uom").val(e.uom),$(".current-bom td .dwg").val(e.drawing_no),$(".current-bom td .dwgr").val(e.revision_no),$("#example1 tbody tr").removeClass("current-bom")}})}),$(document).on("click",".saverow",function(){$("#mask").show(),$(this).parent("td").parent("tr").addClass("save-bom");var e=$("#bom-id").val(),o=$(".save-bom td .partno").val(),d=$(".save-bom td .qty").val(),n=$(".save-bom td .comments").val(),r="&addid=1&id="+e+"&partno="+o+"&qty="+d+"&comments="+n;console.log(r),$.ajax({type:"POST",url:a+"/addoredit",data:r,success:function(a){$.parseJSON(a);t(e),$("#example1 tbody tr").removeClass("save-bom"),$("#mask").hide()}})}),$("#save_bom").click(function(){$("#mask").show();var t=$("#form_addbom").serialize();$.post(a+"/create",{data:t}).done(function(t){$("#mask").hide(),1==t&&e("BOM Creation","Created Successfully"),0==t&&e("BOM Creation","Created Already")})}),$("#import").click(function(){$("#bomimport").modal(),$("#bom-importid").val($("#bom-id").val())})});     
$(document).ready(function() {
    
   

var url='/asteria/admin/bom';
    $('#example1').dataTableExt.sErrMode = 'throw';
    localStorage.removeItem("addall");

    function addtobom(bomid) {
        $.ajax({
            url: url+'/view',
            type: 'post',
            data: '&bom_id=' + bomid,

            success: function(j) {
                var json = $.parseJSON(j);
                $('#bom-id').val(json.id);
                $('#op-type').val('add');
                var bom_material = '<p><span style="color:red;">BOM #:</span>' + json.bom + '</p><p><span style="color:red;">BOM REV#:</span>' + json.bom_rev + '</p><p><span style="color:red;">DATE:</span>' + json.date + '</p>';
                $('#bom-detail').html(bom_material);
                $('#bom_id').val(json.id.id);

                $('#example1').dataTable().fnClearTable();
                $(json.table).each(function(k, v) {
                    var partno = '<select update="' + v.id + '" id="part_' + v.id + '" class="partno" name="partno[]" ><option>Slect Part no</option>';
                    $(json.partno).each(function(m, n) {
                        if (v.material_id == n.id) {
                            partno += '<option value="' + n.id + '" selected="true">' + n.part_no + '</option>';
                        } else {
                            partno += '<option value="' + n.id + '">' + n.part_no + '</option>';
                        }

                    });
                    partno += '</select>';
                    var desc = '<input id="desc_' + v.id + '" type="text" value="' + v.material_desc + '" class="desc" readonly="true">\n\
                                    <input type="hidden" name="bom_ref_id[]"  value="' + v.id + '">';
                    var type = '<input id="type_' + v.id + '" type="text" value="' + v.type + '" class="type" readonly="true">';
                    var qty = '<input name="qty[]" update="' + v.id + '" id="qty_' + v.id + '" type="number" value="' + v.quanty + '" class="qty" >';
                    var uom = '<input id="uom_' + v.id + '" type="text" value="' + v.uom + '" class="uom" readonly="true">';
                    var dwg = '<input id="deg_' + v.id + '" type="text" value="' + v.drawing_no + '" class="dwg" readonly="true">';
                    var dwgr = '<input id="dwgr' + v.id + '" type="text" value="' + v.revision_no + '" class="dwgr" readonly="true">';
                    var comments = '<input name="comments[]" update="' + v.id + '" id="comments_' + v.id + '" type="text" value="' + v.comments + '" class="comments">';
                    var i = $('#example1').dataTable().fnSettings().fnRecordsTotal();

                    $('#example1').dataTable().fnAddData(
                        [i + 1, partno, desc, type, qty, uom, dwg, dwgr, comments, '<a style="cursor:pointer" del="' + v.id + '" id="del' + v.id + '" class="deleterow">DEL</a><br/><a style="cursor:pointer" edit="' + v.id + '" id="edit' + v.id + '" class="updaterow"></a>']);


                });
                $('.bom').removeClass('hidden');

                $('#myTab a[href="#add-edit"]').tab('show');
            }
        });
    }


     jQuery('.materiallist').click(function () {
     $('#bom-edit-id').val('');
     $('#material-id').val('');
     $('#bom-id').val('');
     $('#bom-detail').html('');
     
     $('#example1').dataTable().fnClearTable();
     jQuery('#partno').removeAttr('disabled').attr('required','true');
     jQuery('#project').removeAttr('disabled').attr('required','true');
     jQuery('#reset-bom').trigger('click');
    
});
         $(document).on("click", "#example tbody tr td .edit-bom", function() {
        var id = $(this).attr("id");
        $('#bom-id').val(id);
        $('#bom-edit-id').val(id);
        $('#example1').dataTable().fnClearTable();
        addtobom(id);
        localStorage.removeItem("addall");
        $.ajax({
            url: url+'/editbom',
            type: 'post',
            data: '&edit_bom_id=' + id,

            success: function(j) {
               
                var json = $.parseJSON(j);
                    $('#bom-edit-id').val(json.id);
                    $('#partno').val(json.material_id);
                    $('#material-id').val(json.material_id);
                    $('#partno').attr('disabled','true');
                    $('#project').attr('disabled','true');
                    $('#project').val(json.project_id);
                    $('#bom_description').val(json.desc);
                    $('#myTab a[href="#addbom"]').tab('show');
            }
        });
    });
    
    
    $(document).on("change", "#partno", function() {
        var id = $("#partno option:selected" ).val();
         
        $.ajax({
            url: url+'/addnew',
            type: 'post',
            data: '&create_bom_id=' + id,
            success: function(j) {
                 $('#bom_description').val(j);
                    
            }
        });
     
    });
    
function createBom()
{    
     var formdata = $('#form_addbom').serialize();
        $.post(url+'/create', {'data': formdata })
            .done(function(id) {
                        $('#bom-id').val(id);
                        addBom(id);
                        
                         });
                          
}

function refreshBOM() {
        $.ajax({
            url: url+'/refresh',
            type: 'post',
            success: function(j) {
                var json = $.parseJSON(j);
                $('#example').dataTable().fnClearTable();
                var i=1;
                $(json).each(function(k, v) {
                    if(v.status === 1){j='on';}
                    else{j='off';}
                    var a='<a href="#" class="add-bom" id="'+v.material_id+'">'+v.part_no+'</a>';
                    var b=v.bom_rev_id;
                    var c=v.material_desc;
                    var d='<a href="#" class="edit-bom" id="'+v.id+'">EDIT /</a><a href="#" class="view-bom" id="'+v.id+'">VIEW</a>';
                    var e='<img class="imgswap on" id="approval_'+v.id+'" src="/asteria/public/images/tick_'+j+'.png">';
                    $('#example').dataTable().fnAddData([i++,a,b,c,d,e]);
                     

                });
           
            }
        });
    }

function addBom(id)
{    
     var formdata = $('#addtobom').serializeJSON();
        $.post(url+'/addall', {'data': formdata })
            .done(function(data) {
                       addtobom(id);
                       refreshBOM();
                       $('#mask').hide();
                       
                         });
                          
}

function editBom(id)
{    
     var formdata = $('#form_addbom').serialize();
        $.post(url+'/updatebom', {'data': formdata })
            .done(function(data) {
                     
                       $('#mask').hide();
               refreshBOM();
                         });
}


$('#addall').click(function() {
    var check=localStorage.getItem("addall");
       var table = $('#example1').DataTable();
        var i = $('#example1').dataTable().fnSettings().fnRecordsTotal();
        var j =$('#example1 table tr td option:selected').val();
  
       if(i) {
    if(check)
    {
       $('#mask').show();
       var editid=$('#bom-edit-id').val();
       if(editid){
       addBom(editid);
       editBom();
       
    }
    else{
       createBom();
       }
   }
       }
 });

    $("#addnew").click(function() {
        var table = $('#example1').DataTable();
        var i = $('#example1').dataTable().fnSettings().fnRecordsTotal();
       if(i) {var info = table.page.info();}
        $('#example1 tbody tr').removeClass('current-bom');
        var bomid =$( "#partno option:selected" ).val();
        $.ajax({
            url: url+'/addnew',
            type: 'post',
            data: '&addnew_id=' + bomid,

            success: function(j) {
                var json = $.parseJSON(j);
                var i = $('#example1').dataTable().fnSettings().fnRecordsTotal();
                var partno = '<select class="partno partno' + i + '" name="partnonew[]" ><option value="0">Slect Part no</option>';
                $(json).each(function(k, v) {
                    partno += '<option value="' + v.id + '">' + v.part_no + '</option>';
                });
                partno += '</select>';
                var desc = '<input  type="text" value="" class="desc" readonly="true">';
                var type = '<input type="text" value="" class="type" readonly="true">';
                var qty = '<input name="qtynew[]" type="number" value="" class="qty qty' + i + '" required="true">';
                var uom = '<input type="text" value="" class="uom" readonly="true">';
                var dwg = '<input type="text" value="" class="dwg" readonly="true">';
                var dwgr = '<input type="text" value="" class="dwgr" readonly="true">';
                var comments = '<input name="commentsnew[]" type="text" value="" class="comments comments' + i + '" required="true">';


                $('#example1').dataTable().fnAddData(
                    [i + 1, partno, desc, type, qty, uom, dwg, dwgr, comments, '<a style="cursor:pointer" class="deleterow">DEL</a><br/><a style="cursor:pointer" class="saverow">SAVE</a>']);
            },
            complete: function(j) {
                if(i) {$('#example1').dataTable().fnPageChange(info.pages - 1, true);}

            }
        });


    });
    $(document).on("change", "#bom_description,#example1 tbody tr td input[type=text],select,input[type=number]", function() {
        localStorage.setItem("addall", "1");
    });
    

    $(document).on("click", "#example1 tbody tr td .deleterow", function() {

        var row = $(this).closest('tr');
        var nRow = row[0];
        var id = $('#bom-id').val();
        var delid = $(this).attr('del');
        if (delid) {
            $('#mask').show();
            $.ajax({
                type: 'POST',
                url: url+'/delete',
                data: '&delid=' + delid,
                success: function(response) {
                    addtobom(id);
                    $('#example1').dataTable().fnDeleteRow(nRow);
                    $('#mask').hide();
                }
            });
        } else {
            $('#example1').dataTable().fnDeleteRow(nRow);
        }

    });


    $(document).on("change", "#example1 tbody tr td .partno", function() {
        var row = $(this).attr('update');
        $('#edit' + row).html('UPDATE');
    });
    $(document).on("change", "#example1 tbody tr td .qty", function() {
        var row = $(this).attr('update');
        $('#edit' + row).html('UPDATE');

    });

    $(document).on("change", "#example1 tbody tr td .comments", function() {
        var row = $(this).attr('update');
        $('#edit' + row).html('UPDATE');
    });

    $(document).on("click", "#example1 tbody tr td .updaterow", function() {
         var addall = localStorage.getItem("addall");
         if(addall==1){
             var row = $(this).attr('edit');

        $('#mask').show();
        $(this).parent('td').parent('tr').addClass('save-bom');
        var id = $('#bom-id').val();
        var partno = $('#part_' + row).val();
        var qty = $('#qty_' + row).val();
        var comments = $('#comments_' + row).val();
        var dataString = '&editid=1&id=' + id + '&partno=' + partno + '&qty=' + qty + '&comments=' + comments + '&edit=' + row;
       
        $.ajax({
            type: 'POST',
            url: url+'/addoredit',
            data: dataString,
            success: function(response) {
                var json = $.parseJSON(response);
                addtobom(id);
                $('#example1 tbody tr').removeClass('save-bom');
                $('#mask').hide();
                localStorage.removeItem("addall");
            }
        });}
   
    });



    $(document).on("change", "#example1 tbody tr td .comments", function() {
        var row = $(this).attr('update');
        $('#edit' + row).html('UPDATE');
    });




    $(".imgswap").click(function() {
        var id = $(this).attr("id");
        var vendor_id = id.split("_");
        if ($(this).attr("class") == "imgswap") {
            $('#' + id).attr('src', '<?php echo $this->baseUrl();?>/public/images/tick_on.png')
            this.src = this.src.replace("_off", "_on");
            var status = '1';
        } else {
            $('#' + id).attr('src', '<?php echo $this->baseUrl();?>/public/images/tick_off.png')
            this.src = this.src.replace("_on", "_off");
            var status = '0';
        }
        $(this).toggleClass("on");

        var dataString = '&type=changestatus&id=' + vendor_id[1] + '&status=' + status;

        $.ajax({
            type: "POST",
            url: url+'/changestatus',
            data: dataString,
            success: function(j) {
                console.log(j);
            }
        });
    });



    $(document).on("change", "#example1 tbody tr td .partno", function() {
        var id = $(this).val();

        var row = $(this).parent('td').parent('tr').addClass('current-bom');
        if (id == 0) {
            $('.current-bom td .desc').val('');
            $('.current-bom td .type').val('');
            $('.current-bom td .uom').val('');
            $('.current-bom td .dwg').val('');
            $('.current-bom td .dwgr').val('');
            $('#example1 tbody tr').removeClass('current-bom');
        }
        if (id != 0) {
            $.ajax({
                type: 'POST',
                url:url+'/addbom',
                data: '&bom_add=' + id,
                async: false,
                success: function(response) {
                    var json = $.parseJSON(response);
                    $('.current-bom td .desc').val(json.material_desc);
                    $('.current-bom td .type').val(json.type);
                    $('.current-bom td .uom').val(json.uom);
                    $('.current-bom td .dwg').val(json.drawing_no);
                    $('.current-bom td .dwgr').val(json.revision_no);
                    $('#example1 tbody tr').removeClass('current-bom');

                }
            });
        }


    });



    $(document).on("click", ".saverow", function() {
        var addall = localStorage.getItem("addall");
         if(addall==1){
        $('#mask').show();
        $(this).parent('td').parent('tr').addClass('save-bom');
        var id = $('#bom-id').val();
        var partno = $('.save-bom td .partno').val();
        var qty = $('.save-bom td .qty').val();
        var comments = $('.save-bom td .comments').val();
        var dataString = '&addid=1&id=' + id + '&partno=' + partno + '&qty=' + qty + '&comments=' + comments;
        console.log(dataString);
        $.ajax({
            type: 'POST',
            url: url+'/addoredit',
            data: dataString,
            success: function(response) {
                var json = $.parseJSON(response);
                addtobom(id);
                $('#example1 tbody tr').removeClass('save-bom');
                $('#mask').hide();
                localStorage.removeItem("addall");
            }
        });}
   
    });

    $('#save_bom').click(function() {
        $('#mask').show();
        var id=$('#bom-edit-id').val();
        
        var formdata = $('#form_addbom').serialize();console.log(formdata);
        $.post(url+'/create', {'data': formdata
                })
            .done(function(data) {
                $('#mask').hide();
        if(id){
            if (data == 1) {
                    showModal('BOM Creation', 'Updated Successfully');

                }
               }
                else{if (data == 1) {
                    showModal('BOM Creation', 'Created Successfully');
setTimeout(function(){
  window.location.replace(url);
}, 2000);
                }
                if (data == 0) {
                    showModal('BOM Creation', 'Created Already');
                }}
        
                
            });
    });

    $('#import').click(function() {
       
         $('#bom-importid').val($('#bom-id').val());
         if($('#bom-id').val())
         {
         $('#bomimport').modal();
         }
    });

    function showModal(title, message) {
        $('#bommodal-header').html(title);
        $('.bommodal-create').html('<p>' + message + '</p>');
        $('#bommodal').modal();
    }

});
</script>
       

        
        
  
 
    
   </div>
                                     <div id="mask" style="display:none;width:100%;height:100%;background-color: #FDFDFD;opacity: .7;position: absolute;left:0;top:0;">
                                        
                                         <span class="Centerer"></span>
                                             <img class="Centered" src="<?php echo $this->baseUrl();?>/public/images/loading_spinner.gif" />
                                       
                                     </div>
                            </div>
                            <!-- /block -->
                           
                        </div>
                        
                    </div>
  

    

</div></div>

<div id="bommodal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3 id="bommodal-header">Import BOM</h3>
  </div>
  <div class="bommodal-body bommodal-create" style="padding: 20px;">

  </div>
  <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
  </div>
</div>

<div id="bomimport" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3 id="bomimport-header">Import BOM Material List</h3>
  </div>
     <form enctype="multipart/form-data" method="post" role="form" action="#" data-toggle="validator" >
  <div class="bommodal-body" style="padding: 20px;">
     
           <input class="form-control" type="hidden" value="" name="bom-importid" id="bom-importid">
          <div class="form-group">
       
         <input type="file" name="file" id="file" size="150" required="true">
        <p class="help-block">Only .xls/.xlsx File Import.</p>
    </div>
    
     
  </div>
  <div class="modal-footer">
      <button type="submit" class="btn btn-default" name="Import" value="Import">Import</button>
    <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
  </div>
     </form>
</div>



